{"ast":null,"code":"import React,{useState,useEffect}from\"react\";import{BrowserRouter as Router,Routes,Route}from\"react-router-dom\";import LoginPage from\"./pages/LoginPage\";import AdminDashboard from\"./pages/AdminDashboard\";import AdminObroci from\"./pages/AdminObroci\";import AdminLokacije from\"./pages/AdminLokacije\";import AdminRole from\"./pages/AdminRole\";import AdminKorisnici from\"./pages/AdminKorisnici\";import AdminPregled from\"./pages/AdminPregled\";// ... import all your other pages\nimport{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from\"react/jsx-runtime\";const App=()=>{const[token,setToken]=useState(localStorage.getItem(\"token\")||\"\");// SAFE token decode — NEVER crashes\nconst getUserFromToken=()=>{const storedToken=localStorage.getItem(\"token\");if(!storedToken)return null;try{// This handles malformed base64, padding, etc.\nconst base64Url=storedToken.split('.')[1];if(!base64Url)return null;const base64=base64Url.replace(/-/g,'+').replace(/_/g,'/');const jsonPayload=atob(base64+'=='.substring(0,(4-base64.length%4)%4));return JSON.parse(jsonPayload);}catch(e){console.warn(\"Invalid token in storage, clearing...\");localStorage.removeItem(\"token\");setToken(\"\");return null;}};const user=getUserFromToken();// Update token globally\nconst updateToken=newToken=>{if(newToken){localStorage.setItem(\"token\",newToken);}else{localStorage.removeItem(\"token\");}setToken(newToken||\"\");};return/*#__PURE__*/_jsx(Router,{children:/*#__PURE__*/_jsxs(Routes,{children:[/*#__PURE__*/_jsx(Route,{path:\"/login\",element:/*#__PURE__*/_jsx(LoginPage,{updateToken:updateToken})}),user&&(user.role===\"ROLE_ADMIN\"||user.role===\"ADMIN\")?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Route,{path:\"/admin\",element:/*#__PURE__*/_jsx(AdminDashboard,{})}),/*#__PURE__*/_jsx(Route,{path:\"/admin/obroci\",element:/*#__PURE__*/_jsx(AdminObroci,{})}),/*#__PURE__*/_jsx(Route,{path:\"/admin/lokacije\",element:/*#__PURE__*/_jsx(AdminLokacije,{})}),/*#__PURE__*/_jsx(Route,{path:\"/admin/role\",element:/*#__PURE__*/_jsx(AdminRole,{})}),/*#__PURE__*/_jsx(Route,{path:\"/admin/korisnici\",element:/*#__PURE__*/_jsx(AdminKorisnici,{})}),/*#__PURE__*/_jsx(Route,{path:\"/admin/pregled\",element:/*#__PURE__*/_jsx(AdminPregled,{})})]}):/*#__PURE__*/_jsx(Route,{path:\"*\",element:/*#__PURE__*/_jsx(LoginPage,{updateToken:updateToken})}),/*#__PURE__*/_jsx(Route,{path:\"/\",element:/*#__PURE__*/_jsx(LoginPage,{updateToken:updateToken})})]})});};export default App;","map":{"version":3,"names":["React","useState","useEffect","BrowserRouter","Router","Routes","Route","LoginPage","AdminDashboard","AdminObroci","AdminLokacije","AdminRole","AdminKorisnici","AdminPregled","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","App","token","setToken","localStorage","getItem","getUserFromToken","storedToken","base64Url","split","base64","replace","jsonPayload","atob","substring","length","JSON","parse","e","console","warn","removeItem","user","updateToken","newToken","setItem","children","path","element","role"],"sources":["D:/NARUCIVANJE-FE/src/App.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { BrowserRouter as Router, Routes, Route } from \"react-router-dom\";\r\nimport LoginPage from \"./pages/LoginPage\";\r\nimport AdminDashboard from \"./pages/AdminDashboard\";\r\nimport AdminObroci from \"./pages/AdminObroci\";\r\nimport AdminLokacije from \"./pages/AdminLokacije\";\r\nimport AdminRole from \"./pages/AdminRole\";\r\nimport AdminKorisnici from \"./pages/AdminKorisnici\";\r\nimport AdminPregled from \"./pages/AdminPregled\";\r\n// ... import all your other pages\r\n\r\nconst App = () => {\r\n  const [token, setToken] = useState(localStorage.getItem(\"token\") || \"\");\r\n\r\n  // SAFE token decode — NEVER crashes\r\n  const getUserFromToken = () => {\r\n    const storedToken = localStorage.getItem(\"token\");\r\n    if (!storedToken) return null;\r\n\r\n    try {\r\n      // This handles malformed base64, padding, etc.\r\n      const base64Url = storedToken.split('.')[1];\r\n      if (!base64Url) return null;\r\n      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\r\n      const jsonPayload = atob(base64 + '=='.substring(0, (4 - base64.length % 4) % 4));\r\n      return JSON.parse(jsonPayload);\r\n    } catch (e) {\r\n      console.warn(\"Invalid token in storage, clearing...\");\r\n      localStorage.removeItem(\"token\");\r\n      setToken(\"\");\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const user = getUserFromToken();\r\n\r\n  // Update token globally\r\n  const updateToken = (newToken) => {\r\n    if (newToken) {\r\n      localStorage.setItem(\"token\", newToken);\r\n    } else {\r\n      localStorage.removeItem(\"token\");\r\n    }\r\n    setToken(newToken || \"\");\r\n  };\r\n\r\n  return (\r\n    <Router>\r\n      <Routes>\r\n        <Route path=\"/login\" element={<LoginPage updateToken={updateToken} />} />\r\n        \r\n        {/* Protected admin routes */}\r\n        {user && (user.role === \"ROLE_ADMIN\" || user.role === \"ADMIN\") ? (\r\n          <>\r\n            <Route path=\"/admin\" element={<AdminDashboard />} />\r\n            <Route path=\"/admin/obroci\" element={<AdminObroci />} />\r\n            <Route path=\"/admin/lokacije\" element={<AdminLokacije />} />\r\n            <Route path=\"/admin/role\" element={<AdminRole />} />\r\n            <Route path=\"/admin/korisnici\" element={<AdminKorisnici />} />\r\n            <Route path=\"/admin/pregled\" element={<AdminPregled />} />\r\n            {/* Add all your other admin routes here */}\r\n          </>\r\n        ) : (\r\n          <Route path=\"*\" element={<LoginPage updateToken={updateToken} />} />\r\n        )}\r\n\r\n        {/* Public routes */}\r\n        <Route path=\"/\" element={<LoginPage updateToken={updateToken} />} />\r\n        {/* Add other public pages */}\r\n      </Routes>\r\n    </Router>\r\n  );\r\n};\r\n\r\nexport default App;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}