{"ast":null,"code":"import{BrowserRouter as Router,Route,Routes}from\"react-router-dom\";import React,{useState,useEffect}from\"react\";import{jwtDecode}from\"jwt-decode\";import HomePage from\"./pages/HomePage\";import LoginPage from\"./pages/LoginPage\";import LozinkaPage from\"./pages/LozinkaPage\";import PromenaLozinke from\"./pages/PromenaLozinke\";import MeniPage from\"./pages/MeniPage\";import PregledPage from\"./pages/PregledPage\";import AdminPregled from\"./pages/AdminPregled\";import AdminKorisnici from\"./pages/AdminKorisnici\";import AdminMeniji from\"./pages/AdminMeniji\";import AdminObroci from\"./pages/AdminObroci\";import AdminRole from\"./pages/AdminRole\";import AdminLokacije from\"./pages/AdminLokacije\";import AdminKompanije from\"./pages/AdminKompanije\";import NotAuthorizedPage from\"./pages/NotAuthorizedPage\";import NePostojiPage from\"./pages/NePostojiPage\";import ProtectedRoute from\"./components/ProtectedRoute\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function App(){const[token,setToken]=useState(localStorage.getItem(\"token\"));const[userRole,setUserRole]=useState(\"\");useEffect(()=>{if(token){try{// THIS IS THE ONLY CHANGE – safe jwtDecode with try/catch\nconst decodedToken=jwtDecode(token);setUserRole(decodedToken.role||\"\");}catch(error){console.warn(\"Invalid or corrupted token – clearing it\",error);localStorage.removeItem(\"token\");setToken(null);setUserRole(\"\");}}else{setUserRole(\"\");}},[token]);const updateToken=newToken=>{if(newToken){localStorage.setItem(\"token\",newToken);}else{localStorage.removeItem(\"token\");}setToken(newToken);};return/*#__PURE__*/_jsx(\"div\",{className:\"App\",children:/*#__PURE__*/_jsx(Router,{children:/*#__PURE__*/_jsxs(Routes,{children:[/*#__PURE__*/_jsx(Route,{path:\"/\",element:/*#__PURE__*/_jsx(HomePage,{})}),/*#__PURE__*/_jsx(Route,{path:\"/login\",element:/*#__PURE__*/_jsx(LoginPage,{updateToken:updateToken})}),/*#__PURE__*/_jsx(Route,{path:\"/lozinka\",element:/*#__PURE__*/_jsx(LozinkaPage,{})}),/*#__PURE__*/_jsx(Route,{path:\"/reset-password\",element:/*#__PURE__*/_jsx(PromenaLozinke,{})}),/*#__PURE__*/_jsx(Route,{path:\"/meni\",element:/*#__PURE__*/_jsx(ProtectedRoute,{allowedRoles:['ROLE_USER'],userRole:userRole,children:/*#__PURE__*/_jsx(MeniPage,{})})}),/*#__PURE__*/_jsx(Route,{path:\"/pregled\",element:/*#__PURE__*/_jsx(ProtectedRoute,{allowedRoles:['ROLE_USER'],userRole:userRole,children:/*#__PURE__*/_jsx(PregledPage,{})})}),/*#__PURE__*/_jsx(Route,{path:\"/admin\",element:/*#__PURE__*/_jsx(ProtectedRoute,{allowedRoles:['ROLE_ADMIN'],userRole:userRole,children:/*#__PURE__*/_jsx(AdminPregled,{})})}),/*#__PURE__*/_jsx(Route,{path:\"/admin/meniji\",element:/*#__PURE__*/_jsx(ProtectedRoute,{allowedRoles:['ROLE_ADMIN'],userRole:userRole,children:/*#__PURE__*/_jsx(AdminMeniji,{})})}),/*#__PURE__*/_jsx(Route,{path:\"/admin/obroci\",element:/*#__PURE__*/_jsx(ProtectedRoute,{allowedRoles:['ROLE_ADMIN'],userRole:userRole,children:/*#__PURE__*/_jsx(AdminObroci,{})})}),/*#__PURE__*/_jsx(Route,{path:\"/admin/role\",element:/*#__PURE__*/_jsx(ProtectedRoute,{allowedRoles:['ROLE_ADMIN'],userRole:userRole,children:/*#__PURE__*/_jsx(AdminRole,{})})}),/*#__PURE__*/_jsx(Route,{path:\"/admin/korisnici\",element:/*#__PURE__*/_jsx(ProtectedRoute,{allowedRoles:['ROLE_ADMIN'],userRole:userRole,children:/*#__PURE__*/_jsx(AdminKorisnici,{})})}),/*#__PURE__*/_jsx(Route,{path:\"/admin/lokacije\",element:/*#__PURE__*/_jsx(ProtectedRoute,{allowedRoles:['ROLE_ADMIN'],userRole:userRole,children:/*#__PURE__*/_jsx(AdminLokacije,{})})}),/*#__PURE__*/_jsx(Route,{path:\"/admin/kompanije\",element:/*#__PURE__*/_jsx(ProtectedRoute,{allowedRoles:['ROLE_ADMIN'],userRole:userRole,children:/*#__PURE__*/_jsx(AdminKompanije,{})})}),/*#__PURE__*/_jsx(Route,{path:\"/not-authorized\",element:/*#__PURE__*/_jsx(NotAuthorizedPage,{})}),/*#__PURE__*/_jsx(Route,{path:\"*\",element:/*#__PURE__*/_jsx(NePostojiPage,{})})]})})});}export default App;","map":{"version":3,"names":["BrowserRouter","Router","Route","Routes","React","useState","useEffect","jwtDecode","HomePage","LoginPage","LozinkaPage","PromenaLozinke","MeniPage","PregledPage","AdminPregled","AdminKorisnici","AdminMeniji","AdminObroci","AdminRole","AdminLokacije","AdminKompanije","NotAuthorizedPage","NePostojiPage","ProtectedRoute","jsx","_jsx","jsxs","_jsxs","App","token","setToken","localStorage","getItem","userRole","setUserRole","decodedToken","role","error","console","warn","removeItem","updateToken","newToken","setItem","className","children","path","element","allowedRoles"],"sources":["D:/NARUCIVANJE-FE/src/App.js"],"sourcesContent":["import { BrowserRouter as Router, Route, Routes } from \"react-router-dom\";\r\nimport React, { useState, useEffect } from \"react\";\r\nimport { jwtDecode } from \"jwt-decode\";\r\nimport HomePage from \"./pages/HomePage\";\r\nimport LoginPage from \"./pages/LoginPage\";\r\nimport LozinkaPage from \"./pages/LozinkaPage\";\r\nimport PromenaLozinke from \"./pages/PromenaLozinke\";\r\nimport MeniPage from \"./pages/MeniPage\";\r\nimport PregledPage from \"./pages/PregledPage\";\r\nimport AdminPregled from \"./pages/AdminPregled\";\r\nimport AdminKorisnici from \"./pages/AdminKorisnici\";\r\nimport AdminMeniji from \"./pages/AdminMeniji\";\r\nimport AdminObroci from \"./pages/AdminObroci\";\r\nimport AdminRole from \"./pages/AdminRole\";\r\nimport AdminLokacije from \"./pages/AdminLokacije\";\r\nimport AdminKompanije from \"./pages/AdminKompanije\";\r\nimport NotAuthorizedPage from \"./pages/NotAuthorizedPage\";\r\nimport NePostojiPage from \"./pages/NePostojiPage\";\r\nimport ProtectedRoute from \"./components/ProtectedRoute\";\r\n\r\nfunction App() {\r\n  const [token, setToken] = useState(localStorage.getItem(\"token\"));\r\n  const [userRole, setUserRole] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    if (token) {\r\n      try {\r\n        // THIS IS THE ONLY CHANGE – safe jwtDecode with try/catch\r\n        const decodedToken = jwtDecode(token);\r\n        setUserRole(decodedToken.role || \"\");\r\n      } catch (error) {\r\n        console.warn(\"Invalid or corrupted token – clearing it\", error);\r\n        localStorage.removeItem(\"token\");\r\n        setToken(null);\r\n        setUserRole(\"\");\r\n      }\r\n    } else {\r\n      setUserRole(\"\");\r\n    }\r\n  }, [token]);\r\n\r\n  const updateToken = (newToken) => {\r\n    if (newToken) {\r\n      localStorage.setItem(\"token\", newToken);\r\n    } else {\r\n      localStorage.removeItem(\"token\");\r\n    }\r\n    setToken(newToken);\r\n  };\r\n\r\n  return (\r\n    <div className=\"App\">\r\n      <Router>\r\n        <Routes>\r\n          <Route path=\"/\" element={<HomePage />} />\r\n          <Route path=\"/login\" element={<LoginPage updateToken={updateToken} />} />\r\n          <Route path=\"/lozinka\" element={<LozinkaPage />} />\r\n          <Route path=\"/reset-password\" element={<PromenaLozinke />} />\r\n          <Route path=\"/meni\" element={<ProtectedRoute allowedRoles={['ROLE_USER']} userRole={userRole}><MeniPage /></ProtectedRoute>} />\r\n          <Route path=\"/pregled\" element={<ProtectedRoute allowedRoles={['ROLE_USER']} userRole={userRole}><PregledPage /></ProtectedRoute>} />\r\n          \r\n          <Route path=\"/admin\" element={<ProtectedRoute allowedRoles={['ROLE_ADMIN']} userRole={userRole}><AdminPregled /></ProtectedRoute>} />\r\n          <Route path=\"/admin/meniji\" element={<ProtectedRoute allowedRoles={['ROLE_ADMIN']} userRole={userRole}><AdminMeniji /></ProtectedRoute>} />\r\n          <Route path=\"/admin/obroci\" element={<ProtectedRoute allowedRoles={['ROLE_ADMIN']} userRole={userRole}><AdminObroci /></ProtectedRoute>} />\r\n          <Route path=\"/admin/role\" element={<ProtectedRoute allowedRoles={['ROLE_ADMIN']} userRole={userRole}><AdminRole /></ProtectedRoute>} />\r\n          <Route path=\"/admin/korisnici\" element={<ProtectedRoute allowedRoles={['ROLE_ADMIN']} userRole={userRole}><AdminKorisnici /></ProtectedRoute>} />\r\n          <Route path=\"/admin/lokacije\" element={<ProtectedRoute allowedRoles={['ROLE_ADMIN']} userRole={userRole}><AdminLokacije /></ProtectedRoute>} />\r\n          <Route path=\"/admin/kompanije\" element={<ProtectedRoute allowedRoles={['ROLE_ADMIN']} userRole={userRole}><AdminKompanije /></ProtectedRoute>} />\r\n\r\n          <Route path=\"/not-authorized\" element={<NotAuthorizedPage />} />\r\n          <Route path=\"*\" element={<NePostojiPage />} />\r\n        </Routes>\r\n      </Router>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}